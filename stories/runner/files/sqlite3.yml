resources:
  - name: coupler_test
    connection:
      adapter: sqlite3
      database: db/test.sqlite3
      timeout: 3000
    table: 
      name: records
      primary key: ID
  - name: scratch
    connection:
      adapter: sqlite3
      database: db/scratch.sqlite3
      timeout: 3000
  - name: scores
    connection:
      adapter: sqlite3
      database: db/scores.sqlite3
      timeout: 3000

transformers:
  - name: ssn_filter
    parameters:
      - name: ssn
        regexp: "^(\d)\1{8}$"
    formula: "nil"
    default: "ssn"
    type: "varchar(9)"

scenarios:
  - name: ssn_coupler
    type: self-join
    resource: coupler_test
    transformations:
      - name: ssn
        transformer: ssn_filter
        arguments:
          ssn: ssn
    matchers:
      - field: ssn
        type: exact
    scoring:
      range: 100..100
      combining method: "mean"
  - name: ssn_dob_coupler
    type: self-join
    resource: coupler_test
    transformations:
      - name: ssn
        transformer: ssn_filter
        arguments:
          ssn: ssn
    matchers:
      - field: ssn
        type: exact
      - field: dob
        type: exact
        scores: [40, 60]
    scoring:
      range: 60..160
      combining method: sum
  - name: multi_exact_coupler
    type: self-join
    resource: coupler_test
    transformations:
      - name: ssn
        transformer: ssn_filter
        arguments:
          ssn: ssn
    matchers:
      - fields: [ssn, dob]
        type: exact
    scoring:
      range: 100..100
      combining method: sum
