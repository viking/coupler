resources:
  - name: coupler_test
    connection:
      adapter: sqlite3
      database: db/test.sqlite3
      timeout: 3000
    table: 
      name: records
      primary_key: ID
  - name: scratch
    connection:
      adapter: mysql
      host: localhost
      database: scratch 
      username: scratch
      password: scratch
  - name: scores
    connection:
      adapter: mysql
      host: localhost
      database: scores 
      username: scores
      password: scores

transformers:
  - name: ssn_filter
    parameters:
      - name: ssn
        regexp: "(\d)\1{8}"
    formula: "nil"
    default: "ssn"
    type: varchar(9)
  - name: date_mangler
    parameters:
      - name: date
    formula: "date.nil? ? nil : (Date.parse(date) + 10).to_s"
    type: varchar(10)
  - name: foo_flinger
    parameters:
      - name: foo
    formula: "foo * 10"
    type: int
  - name: bar_bender
    parameters:
      - name: bar
    formula: "bar * 5"
    type: int

scenarios:
  - name: optimus_prime
    type: self-join
    resource: coupler_test
    transformations:
      - name: ssn
        transformer: ssn_filter
        arguments:
          ssn: ssn
      - name: dob
        transformer: date_mangler
        arguments:
          date: dob
      - name: foo
        transformer: foo_flinger
        arguments:
          foo: foo
      - name: bar
        transformer: bar_bender
        arguments:
          bar: bar
    matchers:
      - field: ssn
        type: exact
      - fields: [dob, foo, bar]
        type: exact
    scoring:
      range: 0..100
      combining method: mean
